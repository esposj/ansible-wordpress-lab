---
- hosts: all
  gather_facts: true
  tasks: 
    
  roles:
    - firewalld
    - base


- hosts: load_balancers
  gather_facts: true
  roles: 
    - haproxy

- hosts: web_servers 
  roles:
    - { role: httpd, http_vhost: "{{ansible_fqdn}}"  }
    - { role: httpd, http_vhost: wordpress.j-espo.com }
    - php
  post_tasks:
    - name: install the health check for wordpress
      copy:
        content: "<?php print \"wordpresss: \" . gethostname() . \"<br/>\"; ?>"
        dest: /var/www/vhosts/wordpress.j-espo.com/healthcheck.php
        owner: apache
        group: apache
        mode: 0755

- hosts: db_servers
# see host_vars/* for vaulted variables.
  roles:
    - bertvv.mariadb
